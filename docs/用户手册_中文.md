# ZKTeco K40 生物识别系统用户手册

## 目录

1. [系统概述](#系统概述)
2. [系统架构](#系统架构)
3. [安装指南](#安装指南)
4. [运行指南](#运行指南)
5. [功能模块](#功能模块)
6. [常见问题](#常见问题)
7. [故障排除](#故障排除)

## 系统概述

ZKTeco K40 生物识别系统是一套基于指纹识别技术的健身房会员管理系统，用于会员身份验证、出入管理和考勤记录。系统采用前后端分离架构，包括React前端、FastAPI后端和C#中间件，提供完整的指纹识别解决方案。

### 主要功能

- 会员信息管理
- 设备连接和管理
- 指纹录入和识别
- 实时识别记录
- 数据统计和分析

## 系统架构

系统由三个主要部分组成：

1. **前端应用（Frontend）**：
   - 基于React的Web应用
   - 提供用户界面和交互功能
   - 通过HTTP API和WebSocket与后端通信

2. **后端服务（Backend）**：
   - 基于FastAPI的Python应用
   - 处理业务逻辑和数据存储
   - 提供RESTful API和WebSocket接口
   - 与中间件通信以控制指纹设备

3. **中间件服务（Middleware）**：
   - 基于.NET 6的C#应用
   - 直接与ZKTeco K40指纹设备通信
   - 提供设备控制和指纹操作的API
   - 需要运行在Windows环境下（因为ZKTeco SDK仅支持Windows）

## 安装指南

### 系统要求

- **前端**：Node.js 14+
- **后端**：Python 3.8+
- **中间件**：.NET 6.0+，Windows操作系统
- **数据库**：MySQL 5.7+
- **指纹设备**：ZKTeco K40，通过网络连接

### 安装步骤

#### 1. 克隆代码库

```bash
git clone https://github.com/your-repo/biometric-gym-system.git
cd biometric-gym-system
```

#### 2. 安装前端依赖

```bash
cd frontend
npm install
```

#### 3. 安装后端依赖

```bash
cd ../backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
pip install -r requirements.txt
```

#### 4. 安装中间件依赖

```bash
cd ../middleware
dotnet restore
```

#### 5. 配置数据库

```bash
# 创建数据库
mysql -u root -p
CREATE DATABASE biometric_gym CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
exit;

# 初始化数据库
cd ../backend
python database/init_db.py
```

#### 6. 配置ZKTeco SDK

1. 从ZKTeco官网下载SDK（zkemkeeper.dll）
2. 将SDK文件放置在middleware/SDK目录下
3. 注册COM组件（在Windows上运行）：
   ```
   regsvr32 middleware/SDK/zkemkeeper.dll
   ```

## 运行指南

### 启动中间件（Windows环境）

```bash
cd middleware
dotnet run --urls=http://0.0.0.0:9000
# 或者直接运行
run.bat
```

中间件将在 http://localhost:9000 上运行，Swagger API文档可在 http://localhost:9000/swagger 访问。

### 启动后端服务

```bash
cd backend
python run.py --reload
# 或者使用uvicorn直接启动
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

后端服务将在 http://localhost:8000 上运行，API文档可在 http://localhost:8000/docs 访问。

### 启动前端应用

```bash
cd frontend
npm run dev
```

前端应用将在 http://localhost:3000 上运行。

### 系统访问

在浏览器中访问 http://localhost:3000 即可打开系统界面。

## 功能模块

### 1. 会员管理

会员管理模块提供以下功能：

- **会员列表**：查看所有会员信息，支持分页、搜索和筛选
- **会员详情**：查看会员详细信息，包括基本资料和指纹记录
- **添加会员**：录入新会员信息
- **编辑会员**：修改会员信息
- **删除会员**：删除会员记录（同时删除关联的指纹数据）
- **会员状态管理**：激活或停用会员账户

操作步骤：
1. 在左侧导航栏点击"会员管理"
2. 使用顶部搜索框搜索会员
3. 点击"添加会员"按钮添加新会员
4. 点击会员行查看详情或进行编辑
5. 点击操作列中的按钮进行状态变更或删除操作

### 2. 设备管理

设备管理模块提供以下功能：

- **设备列表**：查看所有指纹设备信息和状态
- **设备连接**：连接到指纹设备
- **设备断开**：断开与指纹设备的连接
- **设备同步**：同步设备数据到系统
- **添加设备**：添加新设备配置
- **编辑设备**：修改设备配置
- **删除设备**：删除设备配置

操作步骤：
1. 在左侧导航栏点击"设备管理"
2. 查看设备列表和状态
3. 点击"添加设备"按钮添加新设备
4. 点击设备行中的"连接"按钮连接设备
5. 点击设备行中的"同步"按钮同步设备数据
6. 点击操作列中的按钮进行编辑或删除操作

### 3. 指纹管理

指纹管理模块提供以下功能：

- **指纹录入**：为会员录入指纹
- **指纹识别**：识别指纹并记录
- **指纹模板管理**：查看和删除指纹模板

操作步骤：

#### 指纹录入：
1. 在左侧导航栏点击"指纹录入"
2. 选择设备和会员
3. 选择手指索引（1-10）
4. 点击"开始录入"按钮
5. 按照提示将手指放在指纹传感器上
6. 完成录入后查看结果

#### 指纹识别：
1. 在左侧导航栏点击"指纹识别"
2. 选择设备
3. 点击"开始识别"按钮
4. 将手指放在指纹传感器上
5. 查看识别结果

### 4. 仪表板

仪表板模块提供以下功能：

- **系统概览**：显示会员数量、设备数量、识别次数等统计信息
- **识别统计**：按小时、日期、设备等维度统计识别记录
- **最近识别记录**：显示最近的识别记录列表

操作步骤：
1. 在左侧导航栏点击"仪表板"
2. 查看各项统计数据和图表
3. 使用时间选择器调整统计时间范围
4. 查看最近识别记录列表

## 常见问题

### 1. 设备连接问题

**问题**：无法连接到指纹设备
**解决方案**：
- 确认设备已正确连接到网络
- 检查设备IP地址和端口配置是否正确
- 确认中间件服务正在运行
- 检查Windows防火墙是否阻止了连接
- 确认ZKTeco SDK已正确安装和注册

### 2. 指纹录入问题

**问题**：指纹录入失败或质量低
**解决方案**：
- 确保手指干净且没有汗水
- 正确放置手指在传感器中心
- 保持手指稳定不要移动
- 尝试调整手指压力
- 如果多次失败，尝试使用另一个手指

### 3. 指纹识别问题

**问题**：指纹识别失败或不准确
**解决方案**：
- 确保手指干净且没有汗水
- 正确放置手指在传感器中心
- 检查是否已为该会员录入指纹
- 尝试重新录入质量更高的指纹模板

### 4. 系统性能问题

**问题**：系统响应缓慢
**解决方案**：
- 检查数据库连接和性能
- 确认服务器资源充足
- 定期清理历史记录数据
- 优化数据库索引

## 故障排除

### 检查服务状态

1. 检查中间件服务：
   - 访问 http://localhost:9000/swagger 确认服务正在运行
   - 查看中间件控制台输出是否有错误信息

2. 检查后端服务：
   - 访问 http://localhost:8000/docs 确认服务正在运行
   - 查看后端控制台输出是否有错误信息

3. 检查前端应用：
   - 访问 http://localhost:3000 确认应用正在运行
   - 使用浏览器开发者工具检查网络请求和错误

### 日志查看

- 后端日志位于 backend/logs 目录
- 中间件日志位于 middleware/logs 目录
- 查看日志文件以获取详细错误信息

### 重启服务

如果遇到问题，尝试按以下顺序重启服务：

1. 重启中间件服务
2. 重启后端服务
3. 重启前端应用

### 联系支持

如果问题无法解决，请联系技术支持：

- 邮箱：support@example.com
- 电话：+86 123 4567 8910
